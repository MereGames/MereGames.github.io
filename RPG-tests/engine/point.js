function PointJS(Ub,Z,aa,Va){var g=window,V=this,sa=!0,Wa=!0,pb=!1,ba=!1,p=Z,q=aa,F=p/2,G=q/2,f={x:0,y:0},v={fillStyle:"black",strokeStyle:"black",globalAlpha:1,font:"sans-serif",textBaseline:"top"},H=function(a){console.log("[PointJS] : ",a)},Ca=function(a){var b=decodeURI(a.stack.toString().replace(/(@|[\(\)]|[\w]+:\/\/)/g,"")),b=b.split(/\n/),b=(""==b[2]?b[0]:b[1]).split("/"),b=b[b.length-1].split(":");console.log('ERROR "'+a.toString()+'" \n in      '+b[0]+" \n line:   "+b[1]+" \n symbol: "+b[2])};
this.game={};this.camera={};this.keyControl={};this.mouseControl={};this.touchControl={};this.system={};this.vector={};this.math={};this.colors={};this.brush={};this.audio={};this.wAudio={};this.dialogs={};this.resources={};this.tiles={};this.OOP={};this.GUI={};this.GL={};this.system.log=H;this.system.setSettings=function(a){sa=r(a.isShowError)?a.isShowError:!0;Wa=r(a.isStopForError)?a.isStopForError:!0;pb=r(a.isAutoClear)?a.isAutoClear:!1;r(a.isZBuffer)};this.system.setDefaultSettings=function(a){for(var b in a)v[b]=
a[b]};var qb="",rb="",sb=function(a,b){var c=h.createShader(a);h.shaderSource(c,b);h.compileShader(c);return h.getShaderParameter(c,h.COMPILE_STATUS)?c:(H("Error shader compilation: "+h.getShaderInfoLog(c)),h.deleteShader(c),null)},P,h=!1,K=!1,Vb=function(){K=g.document.createElement("canvas");K.width=p;K.height=q;K.style.position="fixed";K.style.left=0;K.style.top=0;K.style.zIndex=n.style.zIndex+1;K.id="PointJS-canvas_1";K.style.backgroundColor="black";l.attach(K);l.addEvent("onload","hideSourceCanvas",
function(){n.style.display="none"});h=K.getContext("webgl")||K.getContext("experimental-webgl");h.viewport(0,0,p,q);h.clearColor(0,0,0,1);h.clear(h.COLOR_BUFFER_BIT)},Xa,Ya,tb,ub,Za,$a,Wb=function(){var a=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,a);h.bufferData(h.ARRAY_BUFFER,new Float32Array([0,0,p,0,0,q,0,q,p,0,p,q]),h.STATIC_DRAW);Ya=h.getAttribLocation(P,"aPosition");tb=h.getUniformLocation(P,"uResolution");Xa=h.getAttribLocation(P,"aTextCoord");Za=h.getUniformLocation(P,"uInversion");$a=
h.getUniformLocation(P,"uMirrorX");h.uniform2f(tb,p,q);h.enableVertexAttribArray(Ya);h.vertexAttribPointer(Ya,2,h.FLOAT,!1,0,0);a=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,a);h.bufferData(h.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),h.STATIC_DRAW);h.enableVertexAttribArray(Xa);h.vertexAttribPointer(Xa,2,h.FLOAT,!1,0,0);ub=h.createTexture();h.bindTexture(h.TEXTURE_2D,ub);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE);
h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST);h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST)};this.GL.filter=function(a,b){if(!h)return H("GL is not inited. Use a initGL() function.");"inversion"==a&&h.uniform1i(Za,1);"mirror-x"==a&&h.uniform1i($a,1)};var d=function(a,b){return{x:a,y:b}},z=function(a,b){return{w:a,h:b}},ka=function(a,b){return{x:a.x+b.x,y:a.y+b.y}},ab=function(a,b){return{x:a.x-b.x,y:a.y-b.y}},I=function(a,b,c){if(0!=c){var e=u(c);c=a.x-b.x;a=a.y-b.y;
var f=Math.cos(e),e=Math.sin(e);return d(c*f-a*e+b.x,c*e+a*f+b.y)}return d(a.x,a.y)},vb=function(a,b){return 180/Math.PI*Math.atan2(b.y-a.y,b.x-a.x)},ca=function(a,b){if(3>b.length)return!1;for(var c=0,e=b.length-1,d=b[e].y<a.y,f=0;f<b.length;++f){var g=b[f].y<a.y,e=ab(b[e],a),k=ab(b[f],a),e=e.x*(k.y-e.y)-e.y*(k.x-e.x);g&&!d&&0<e&&(c+=1);!g&&d&&0>e&&(c+=1);e=f;d=g}return 0!=(c&1)};this.vector.dpi=function(a,b){return a*b};this.vector.point=d;this.vector.v2d=d;this.vector.size=z;this.vector.w2h=z;
this.vector.getPointAngle=I;this.vector.isPointIn=ca;this.vector.pointMinus=ab;this.vector.pointPlus=ka;this.vector.pointInc=function(a,b){return{x:a.x*b.x,y:a.y*b.y}};this.vector.pointDiv=function(a,b){return{x:a.x/(0!=b.x?b.x:1),y:a.y/(0!=b.y?b.y:1)}};this.vector.pointAbs=function(a){return{x:Math.abs(a.x),y:Math.abs(a.y)}};this.vector.getMidPoint=function(a,b){return r(b)?d((a.x+b.x)/2,(a.y+b.y)/2):0};this.vector.getDistance=function(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))};
this.vector.isSame=function(a,b){return r(b)?a.x==b.x&&a.y==b.y:!1};this.vector.getAngle2Points=vb;this.vector.newStaticBox=function(a,b,c,e){return{x:a,y:b,w:a+c,h:b+e}};this.vector.newDynamicBoxRect=function(a,b,c,e){return[d(x,y),d(x+Z,y),d(x+Z,y+aa),d(x,y+aa)]};var u=function(a){return Math.PI/180*a},W=function(a,b,c){var e=Math.floor(Math.random()*(b-a+1)+a);return c&&0==e?W(a,b,c):e};this.math.limit=function(a,b){var c=0<a?1:-1,e=0<b?1:-1;a=Math.abs(a);b=Math.abs(b);return a<b?a*c:b*e};this.math.sign=
function(a){return 0>a?-1:1};this.math.a2r=u;this.math.random=W;this.math.toInt=function(a){return a>>0};var Xb=0,l={loaded:!1,events:{onload:{},preLoop:{},postLoop:{},gameBlur:{},gameFocus:{},gameResize:{}},addEvent:function(a,b,c){"onload"==a&&l.loaded?c():l.events[a][b]=c},delEvent:function(a,b){delete l.events[a][b]},runEvent:function(a){for(var b in l.events[a])if("function"==typeof l.events[a][b])l.events[a][b]()},attach:function(a){var b=function(){g.document.body.appendChild(a)};l.loaded?
b():l.addEvent("onload","attachElement_PointJS"+Xb++,b)},getWH:function(){return{w:parseInt(g.document.documentElement.clientWidth)<parseInt(screen.width)?parseInt(g.document.documentElement.clientWidth):parseInt(screen.width),h:parseInt(g.document.documentElement.clientHeight)<parseInt(screen.height)?parseInt(g.document.documentElement.clientHeight):parseInt(screen.height)}}};this.system.delEvent=function(a,b){l.delEvent(a,b)};this.system.addEvent=function(a,b,c){l.addEvent(a,b,c)};this.system.attachDOM=
function(a){l.attach(a)};this.system.newDOM=function(a){a=g.document.createElement(a);a.style.position="fixed";a.style.left=0;a.style.top=0;a.style.zIndex=n.style.zIndex+1;a.style.border="none";l.attach(a);return a};var n=g.document.createElement("canvas");n.width=parseInt(Z);n.height=parseInt(aa);n.style.position="fixed";n.style.left=0;n.style.top=0;n.style.zIndex=1E3;n.id="PointJS-canvas_0";n.style.backgroundColor="black";if("object"==typeof Va)for(var bb in Va)bb.match(/margin|padding|position/)||
(n.style[bb]=Va[bb]);l.addEvent("onload","Window_Hide_Scroll",function(){g.document.body.style.overflow="hidden";cb={x:parseInt(n.style.left),y:parseInt(n.style.top)}});var cb=d(0,0),k=null,h=null,k=n.getContext("2d");"GL2D"==Ub?(Vb(),rb="\n\t\tattribute vec2 aPosition;\n\t\tattribute vec2 aTextCoord;\n\n\t\tuniform vec2 uResolution;\n\t\tuniform int uMirrorX;\n\n\t\tvarying vec2 vTextureCoord;\n\n\t\tvoid main() {\n\t\t   vec2 zeroToOne = aPosition / uResolution;\n\t\t   vec2 zeroToTwo = zeroToOne * 2.0;\n\t\t   vec2 clipSpace = zeroToTwo - 1.0;\n\t\t   gl_Position = vec4(clipSpace * vec2((uMirrorX == 1 ? -1 : 1), -1), 0, 1);\n\t\t   vTextureCoord = aTextCoord;\n\t\t}\n\t\t",
qb="\n\t\tprecision mediump float;\n\t\tuniform sampler2D texture;\n\t\tvarying vec2 vTextureCoord;\n\n\t\tuniform int uInversion;\n\n\t\tvoid main() {\n   vec4 texColor = texture2D(texture,vTextureCoord.xy);\n   vec4 finalColor;\n\n   finalColor = texColor;\n\n   if (uInversion == 1)\n   \tfinalColor = 1.0 - finalColor;\n\n   gl_FragColor = finalColor;\n\n\t\t}\n\t\t",P=h.createProgram(),h.attachShader(P,sb(h.VERTEX_SHADER,rb)),h.attachShader(P,sb(h.FRAGMENT_SHADER,qb)),h.linkProgram(P),h.getProgramParameter(P,
h.LINK_STATUS)||H("Can't install shader"),h.useProgram(P),Wb(),l.addEvent("postLoop","drawGL",function(){h?(h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,n),h.drawArrays(h.TRIANGLES,0,6),h.uniform1i(Za,0),h.uniform1i($a,0)):H("GL is not inited. Use a initGL() function.")})):l.attach(n);var wb=null,xb=null,da=function(a){wb!=a&&(wb=a,k.fillStyle=a)},Da=function(a){xb!=a&&(xb=a,k.strokeStyle=a)};this.system.setStyle=function(a){if("object"==typeof a)for(var b in a)n.style[b]=a[b]};this.system.getContext=
function(){return k};this.system.resize=function(a,b){p=a||Z;q=b||aa;F=p/2;G=q/2;n.width=p;n.height=q};this.system.initFullPage=function(){l.addEvent("gameResize","PointJS_resizeGame",function(){p=l.getWH().w;q=l.getWH().h;F=p/2;G=q/2;n.width=p;n.height=q});l.runEvent("gameResize","PointJS_resizeGame")};var X=!1,Yb=function(){X||(this.requestFullscreen?(this.requestFullscreen(),X=!0):this.mozRequestFullScreen?(this.mozRequestFullScreen(),X=!0):this.webkitRequestFullscreen&&(this.webkitRequestFullscreen(),
X=!0),p=l.getWH().w,q=l.getWH().h,F=p/2,G=q/2,n.width=p,n.height=q)},db=function(a){X=yb(g.document.fullscreenElement||g.document.mozFullScreenElement||g.document.webkitFullscreenElement)};g.document.addEventListener("webkitfullscreenchange",db);g.document.addEventListener("mozfullscreenchange",db);g.document.addEventListener("fullscreenchange",db);this.system.initFullScreen=function(){g.document.documentElement.onclick=Yb;l.addEvent("gameResize","PointJS_resizeGame",function(){p=l.getWH().w;q=l.getWH().h;
F=p/2;G=q/2;n.width=p;n.height=q});l.runEvent("gameResize","PointJS_resizeGame")};this.system.exitFullScreen=function(){g.document.exitFullscreen?(g.document.exitFullscreen(),X=!1):g.document.mozCancelFullScreen?(g.document.mozCancelFullScreen(),X=!1):g.document.webkitExitFullscreen&&(g.document.webkitExitFullscreen(),X=!1);p=l.getWH().w;q=l.getWH().h;F=p/2;G=q/2;n.width=p;n.height=q;p=Z;q=aa;F=p/2;G=q/2;n.width=p;n.height=q};this.system.isFullScreen=function(){return X};this.system.exitFullPage=
function(){p=Z;q=aa;F=p/2;G=q/2;n.width=p;n.height=q};var R=!1;this.system.initFullScale=function(a){l.addEvent("gameResize","PointJS_resizeGame",function(){var a=p,c=q,e=l.getWH();e.w<e.h?(c=e.w/p,a=e.w,c*=q):e.w>e.h&&(a=e.h/q,c=e.h,a*=p);R={w:a/p,h:c/q};n.style.width=a+"px";n.style.height=c+"px"});l.runEvent("gameResize","PointJS_resizeGame")};this.system.exitFullScale=function(){n.style.width=Z+"px";n.style.height=aa+"px"};this.system.getWH=function(){return l.getWH()};var Zb=[],$b=0,la=function(a,
b){var c=g.document.createElement(a);c.style.position="fixed";c.style.zIndex=n.style.zIndex+1;c.style.outline="none";c.style.left=b.x?b.x+"px":0;c.style.top=b.y?b.y+"px":0;b.w&&(c.style.width=b.w+"px");b.h&&(c.style.height=b.h+"px");c.style.backgroundColor=b.fillColor?b.fillColor:"";c.style.color=b.color?b.color:"black";c.style.border=(b.strokeWidth||0)+"px solid "+(b.strokeColor||"");c.onmousedown=c.onmouseup=c.onmousemove=c.onclick=c.onkeydown=c.onkeypress=c.onkeyup=function(a){a.stopPropagation()};
c.oncontextmenu=c.onselectstart=c.ondragstart=function(a){a.stopPropagation();return!1};this.w=b.w||0;this.h=b.h||0;this.el=c;this.id=$b++;this.visible=!0;if(b.events)this.onEvents(b.events);b.style&&this.setStyle(b.style);Zb.push(this)};la.prototype={onEvents:function(a){"function"==typeof a.keyPress&&(this.el.onkeypress=function(b){b.stopPropagation();var c=!1;0!=b.which&&0!=b.charCode&&32<=b.which&&(c=String.fromCharCode(b.which));return a.keyPress(c)});"function"==typeof a.change&&(this.el.oninput=
function(b){b.stopPropagation();a.change()});"function"==typeof a.mouseOver&&(this.el.onmouseover=function(b){b.stopPropagation();a.mouseOver()});"function"==typeof a.mouseOut&&(this.el.onmouseleave=function(b){b.stopPropagation();a.mouseOut()});"function"==typeof a.click&&(this.el.onclick=function(b){b.stopPropagation();a.click()});"function"==typeof a.mousePress&&(this.el.onmousedown=function(b){b.stopPropagation();a.mousePress()});"function"==typeof a.mouseUp&&(this.el.onmouseup=function(b){b.stopPropagation();
a.mouseUp()})},getID:function(){return this.id},move:function(a){this.el.style.left=parseInt(this.el.style.left)+a.x+"px";this.el.style.top=parseInt(this.el.style.top)+a.y+"px"},setPosition:function(a){this.el.style.left=a.x+"px";this.el.style.top=a.y+"px"},setPositionC:function(a){this.el.style.left=a.x-this.w/2+"px";this.el.style.top=a.y-this.h/2+"px"},getPosition:function(){return d(parseInt(this.el.style.left),parseInt(this.el.style.top))},getPositionC:function(){return d(parseInt(this.el.style.left)+
this.w/2,parseInt(this.el.style.top)+this.h/2)},setSize:function(a){this.w=a.w;this.h=a.h;this.el.style.width=a.w+"px";this.el.style.height=a.h+"px"},getSize:function(){return z(this.w,this.h)},setStyle:function(a){for(var b in a)this.el.style[b]=a[b]},setVisible:function(a){if(this.visible=a)return this.el.style.display="block";this.el.style.display="none"},isVisible:function(){return this.visible},setEnabled:function(a){this.enabled=a;this.el.disabled=!a},setText:function(a){this.el.innerHTML&&
(this.el.innerHTML=a,this.w=parseInt(this.el.offsetWidth),this.h=parseInt(this.el.offsetHeight));this.el.value&&(this.el.value=a)}};this.GUI.newButton=function(a){var b=new la("input",a);b.el.type="button";b.el.value=a.text?a.text:"Button "+b.id;l.attach(b.el);return b};this.GUI.newInput=function(a){var b=new la("input",a);b.el.type="text";b.el.value=a.text?a.text:"Button "+b.id;b.el.oncontextmenu=b.el.onselectstart=b.el.ondragstart=function(a){};l.attach(b.el);return b};this.GUI.newPanel=function(a){var b=
new la("div",a);b.el.innerHTML=a.text?a.text:"Panel "+b.id;l.attach(b.el);return b};this.GUI.newImage=function(a){var b=new la("img",a);if(!a.file)return H("error in GUI.newImage: Where image file?");b.el.src=a.file;l.attach(b.el);b.el.onload=function(){b.w||(b.w=parseInt(this.width));b.h||(b.h=parseInt(this.height))};return b};this.GUI.newHTML=function(a){var b=new la("div",a);b.el.innerHTML=a.text?a.text.toString():"Your HTML Text";l.attach(b.el);l.addEvent("onload","getWH_HTMLPanel"+b.id,function(){b.w||
(b.w=parseInt(b.el.offsetWidth));b.h||(b.h=parseInt(b.el.offsetHeight))});return b};var Ea={LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,CTRL:17,SHIFT:16,ALT:18,ESC:27,ENTER:13,MINUS:189,PLUS:187,CAPS_LOCK:20,BACKSPACE:8,TAB:9,Q:81,W:87,E:69,R:82,T:84,Y:89,U:85,I:73,O:79,P:80,A:65,S:83,D:68,F:70,G:71,H:72,J:74,K:75,L:76,Z:90,X:88,V:86,B:66,N:78,M:77,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,C:67,9:57,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},ac={37:"LEFT",
39:"RIGHT",38:"UP",40:"DOWN",32:"SPACE",17:"CTRL",16:"SHIFT",18:"ALT",27:"ESC",13:"ENTER",189:"MINUS",187:"PLUS",20:"CAPS_LOCK",8:"BACKSPACE",9:"TAB",81:"Q",87:"W",69:"E",82:"R",84:"T",89:"Y",85:"U",73:"I",79:"O",80:"P",65:"A",83:"S",68:"D",70:"F",71:"G",72:"H",74:"J",75:"K",76:"L",90:"Z",88:"X",86:"V",66:"B",78:"N",77:"M",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",67:"C",57:"9",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",
123:"F12"},bc={8:!0,9:!0,13:!0,18:!0,16:!0,17:!0,27:!0,112:!0,113:!0,114:!0,115:!0,116:!0,117:!0,118:!0,119:!0,120:!0,121:!0,122:!0,123:!0};this.keyControl.getKeyList=function(){var a,b=[];for(a in Ea)b.push(a);return b};var ma={},ta={},ea={},ua=!1,va=!1,Fa=!1,cc=function(a){eb(ea,function(a,c,e){1==a&&(e[c]=2)})};this.keyControl.isDown=function(a){return 1==ma[Ea[a]]};this.keyControl.isUp=function(a){return 1==ta[Ea[a]]};this.keyControl.isPress=function(a){return 1==ea[Ea[a]]};this.keyControl.getInputChar=
function(){return ua};this.keyControl.getInputKey=function(){return ac[va]};this.keyControl.setInputMode=function(a){Fa=a};this.keyControl.isInputMode=function(){return Fa};this.keyControl.exitKeyControl=function(){g.onkeydown=function(){};g.onkeypress=function(){};g.onkeyup=function(){};l.delEvent("postLoop","PointJS_clearAllKeyUp");ma={};ta={};ea={};Fa=va=ua=!1};this.keyControl.initKeyControl=function(){g.onkeydown=function(a){if(Fa)return va=a.keyCode,bc[a.keyCode]?(a.preventDefault(),!1):!0;a.preventDefault();
2!=ea[a.keyCode]&&(ea[a.keyCode]=1);ma[a.keyCode]=!0;return!1};g.onkeypress=function(a){var b=!1;0!=a.which&&0!=a.charCode&&32<=a.which&&(b=String.fromCharCode(a.which));ua=b};g.onkeyup=function(a){a.preventDefault();1==ma[a.keyCode]&&(ta[a.keyCode]=!0);ma[a.keyCode]=!1;delete ea[a.keyCode];return!1};l.addEvent("postLoop","PointJS_clearAllKeyUp",function(){ta={};cc();va=ua=!1});return this};var A=d(0,0),Ga=d(0,0);d(0,0);var wa=!0,fb="",Ha=!1,fa=d(0,0),Ia=!1,gb={LEFT:1,RIGHT:3,MIDDLE:2},Ja={},Ka={},
xa={},ya=0,zb=function(){Ja={};Ka={};xa={};ya=0;Ia=!1},dc=function(){eb(xa,function(a,b,c){1==a&&(c[b]=2)})},La=function(a){var b=0,c=0;a&&(b=f.x,c=f.y);return d(b+A.x,c+A.y)};this.mouseControl.getPosition=function(){return La(1)};this.mouseControl.getPositionS=function(){return La()};this.mouseControl.setCursorImage=function(a){fb='url("'+a+'"), auto';g.document.body.style.cursor=fb};this.mouseControl.setVisible=function(a){!wa&&!a||wa&&a||(wa=1==a,g.document.body.style.cursor=wa?fb:"none")};this.mouseControl.isVisible=
function(){return wa};this.mouseControl.isDown=function(a){return Ja[gb[a]]};this.mouseControl.isUp=function(a){return Ka[gb[a]]};this.mouseControl.isPress=function(a){return 1==xa[gb[a]]};this.mouseControl.isMove=function(){return Ia};this.mouseControl.isInStatic=function(a){var b=La(1);return b.x>=a.x&&b.x<=a.x+a.w&&b.y>=a.y&&b.y<=a.y+a.h};this.mouseControl.isInDynamic=function(a){return ca(La(1),a)};this.mouseControl.isInObject=function(a){return a.visible?a.angle?this.isInDynamic(a.getDynamicBox()):
this.isInStatic(a.getStaticBox()):!1};this.mouseControl.isWheel=function(a){return"UP"==a&&0<ya||"DOWN"==a&&0>ya};var Ab=function(a){a.preventDefault();ya=a.wheelDelta?a.wheelDelta:-a.detail;return!1},Ma=!1,Bb=function(){Ma&&(Ha=r(g.document.pointerLockElement)||r(g.document.mozPointerLockElement)?!0:!1)};this.mouseControl.initMouseLock=function(){l.addEvent("onload","initPointerLock",function(){Ma=n.requestPointerLock||n.mozRequestPointerLock||!1;g.document.exitPointerLock=g.document.exitPointerLock||
g.document.mozExitPointerLock||!1;"onpointerlockchange"in g.document?g.document.addEventListener("pointerlockchange",Bb,!1):"onmozpointerlockchange"in g.document&&g.document.addEventListener("mozpointerlockchange",Bb,!1);if(!Ma)return H("error in initMouseLock: not supported");Ha||(n.onclick=Ma)})};this.mouseControl.exitMouseLock=function(){g.document.exitPointerLock();n.onclick=function(){};fa=d(0,0)};this.mouseControl.unlockMouse=function(){fa=d(0,0);g.document.exitPointerLock()};this.mouseControl.isMouseLock=
function(){return Ha};this.mouseControl.getSpeed=function(){return d(fa.x,fa.y)};this.mouseControl.isPeekStatic=function(a,b){return this.isPress(a)?this.isInStatic(b):!1};this.mouseControl.isPeekDynamic=function(a,b){return this.isPress(a)?this.isInDynamic(b):!1};this.mouseControl.isPeekObject=function(a,b){return this.isPress(a)&&b.visible?this.isInDynamic(b.getDynamicBox()):!1};this.mouseControl.initMouseControl=function(){g.onmousemove=function(a){a.preventDefault();a.stopPropagation();if(Ha){var b=
a.movementY||a.mozMovementY||0;A.x+=a.movementX||a.mozMovementX||0;A.y+=b;return!1}A.x=a.pageX-cb.x;A.y=a.pageY-cb.y;R&&(A.x/=R.w,A.y/=R.h);fa.x=A.x-Ga.x;fa.y=A.y-Ga.y;Ga.x=A.x;Ga.y=A.y;Ia=!0;return!1};g.onmousedown=function(a){a.preventDefault();a.stopPropagation();!a.which&&a.button&&(a.button&1?a.which=1:a.button&4?a.which=2:a.button&2&&(a.which=3));Ja[a.which]=!0;xa[a.which]=1};g.onmouseup=function(a){a.preventDefault();a.stopPropagation();!a.which&&a.button&&(a.button&1?a.which=1:a.button&4?
a.which=2:a.button&2&&(a.which=3));Ja[a.which]=!1;Ka[a.which]=!0;delete xa[a.which]};g.oncontextmenu=g.onselectstart=g.ondragstart=function(){return!1};g.onmousewheel=Ab;g.addEventListener("DOMMouseScroll",Ab,!1);l.addEvent("postLoop","PointJS_clearAllMouseUp",function(){Ka={};dc();ya=0;Ia=!1;fa=d(0,0)});return this};this.mouseControl.exitMouseControl=function(){g.onmousemove=g.onmousedown=g.onmouseup=g.oncontextmenu=g.onselectstart=g.ondragstart=g.onmousewheel=function(){};l.delEvent("postLoop",
"PointJS_clearAllMouseUp");zb()};var Na=!1,Oa=0,Pa=0,C=0,D=0,t=d(0,0),za=d(0,0),Qa=d(0,0),Cb=function(){Na=!1;Pa=Oa=0;t=d(0,0);D=C=0};this.touchControl.getFixPositionS=function(){return t.x||t.y?d(t.x,t.y):!1};this.touchControl.getFixPosition=function(){return t.x||t.y?d(t.x+f.x,t.y+f.y):!1};this.touchControl.getRun=function(){var a=0,b=0;t.x&&t.x!=C&&(a=C-t.x);t.y&&t.y!=D&&(b=D-t.y);return d(a,b)};this.touchControl.getVector=function(){var a=0,b=0;t.x&&t.x!=C&&(a=C>t.x?1:-1);t.y&&t.y!=D&&(b=D>t.y?
1:-1);return d(a,b)};this.touchControl.getSpeed=function(){return d(za.x,za.y)};this.touchControl.isDown=function(){return Na};this.touchControl.isPress=function(){return 1==Oa};this.touchControl.isUp=function(){return 1==Pa};this.touchControl.getPosition=function(){return d(C+f.x,D+f.y)};this.touchControl.getPositionS=function(){return d(C,D)};this.touchControl.isPeekStatic=function(a){return this.isPress()?this.isInStatic(a):!1};this.touchControl.isPeekDynamic=function(a){return this.isPress()?
this.isInDynamic(a):!1};this.touchControl.isPeekObject=function(a){return this.isPress()&&a.visible?this.isInDynamic(a.getDynamicBox()):!1};this.touchControl.isInStatic=function(a){var b=this.getPosition();return b.x>=a.x&&b.x<=a.x+a.w&&b.y>=a.y&&b.y<=a.y+a.h};this.touchControl.isInDynamic=function(a){return ca(this.getPosition(),a)};this.touchControl.isInObject=function(a){return a.visible?a.angle?this.isInDynamic(a.getDynamicBox()):this.isInStatic(a.getStaticBox()):!1};this.touchControl.initTouchControl=
function(){g.addEventListener("touchstart",function(a){a.preventDefault();C=a.targetTouches[0].pageX;D=a.targetTouches[0].pageY;R&&(C/=R.w,D/=R.h);t.x=C;t.y=D;Na=!0;Oa=1;return!1},!1);g.addEventListener("touchmove",function(a){a.preventDefault();C=a.targetTouches[0].pageX;D=a.targetTouches[0].pageY;R&&(C/=R.w,D/=R.h);za.x=C-Qa.x;za.y=D-Qa.y;return!1},!1);g.addEventListener("touchend",function(a){a.preventDefault();t.x=0;t.y=0;Na=!1;Pa=1;return!1},!1);V.touchControl.vibrate=function(a){if(g.navigator.vibrate)return g.navigator.vibrate(a);
if(g.navigator.oVibrate)return g.navigator.oVibrate(a);if(g.navigator.mozVibrate)return g.navigator.mozVibrate(a);if(g.navigator.webkitVibrate)return g.navigator.webkitVibrate(a)};l.addEvent("postLoop","PointJS_touchStopPress",function(){Pa=Oa=0;Qa.x=C;Qa.y=D;za=d(0,0)});return this};this.touchControl.exitTouchControl=function(){g.ontouchstart=g.ontouchmove=g.ontouchend=function(a){};l.delEvent("postLoop","PointJS_touchStopPress");Cb()};var ec={name:"PointJS",desc:"2D game engine for JavaScript",
author:"Skaner -> skaner0@yandex.ru"};this.system.getInfo=function(){return ec};var Ra=function(a,b,c,e){return"rgba("+a+", "+b+", "+c+", "+(e?e:1)+")"},Db=function(a,b){a="#"==a[0]?a.substr(1,6):a;var c=parseInt(a.substr(0,2),16),e=parseInt(a.substr(2,2),16),d=parseInt(a.substr(4,2),16);return Ra(c,e,d,b)};this.colors.rgb=function(a,b,c){return Ra(a,b,c,1)};this.colors.rgba=function(a,b,c,e){return Ra(a,b,c,e)};this.colors.hex2rgb=function(a){return Db(a,1)};this.colors.hex2rgba=function(a,b){return Db(a,
b)};this.colors.randomColor=function(a,b,c){return Ra(W(a,b),W(a,b),W(a,b),c||1)};var r=function(a){return"undefined"==typeof a||null==a?!1:!0},yb=function(a){return r(a)&&""!==a&&0!==a?!0:!1},eb=function(a,b){for(var c in a){if(!a[c])break;b(a[c],c,a)}},Eb=function(a,b){if(0!=a.length){var c,e;c=0;for(e=a.length;c<e&&a[c];c++)b(a[c],c,a)}};this.OOP.insertArrElement=function(a,b){var c=a[b];a.splice(b,1);return c};this.OOP.insertRandArrElement=function(a){var b=W(0,a.length-1),c=a[b];a.splice(b,1);
return c};this.OOP.drawArr=function(a){var b,c;b=0;for(c=a.length;b<c;b++)a[b].isInCamera&&a[b].draw&&a[b].isInCamera()&&a[b].draw()};this.OOP.readJSON=function(a,b){var c={},e=new XMLHttpRequest;e.open("GET",a,!0);w.add();e.onreadystatechange=function(){4==e.readyState&&(c=e.responseText,c=JSON.parse(c),w.load(),b(c))};e.send()};this.OOP.toString=function(a,b){var c,e=0,d,f="[";for(c in a)d=a[c],"number"==typeof d&&b&&(d=parseInt(d)),f+=(0<e?", ":"")+c+" : "+d,e++;return f+"]"};this.OOP.isDef=r;
this.OOP.isSet=yb;this.OOP.forEach=eb;this.OOP.forInt=function(a,b){var c;for(c=0;c<a;c++)b(c)};this.OOP.forXY=function(a,b,c){var e,d;for(d=0;d<b;d++)for(e=0;e<a;e++)c(e,d)};this.OOP.forArr=Eb;this.OOP.randArrElement=function(a){return a[W(0,a.length)]};this.OOP.readJSONSync=function(a){var b=new XMLHttpRequest;b.open("GET",a,!1);b.send();a=b.responseText;return a=JSON.parse(a)};var ga=60,E=Date.now(),Sa=0,Ta=-1,Fb=E,na={};this.game.setFPS=function(a){ga=0<a?a:60};this.game.getFPS=function(){return ga};
this.game.getDT=function(a){a||(a=1E3);return Sa/a};this.game.getTime=function(){return E};var Gb=function(){return g.requestAnimationFrame||g.webkitRequestAnimationFrame||g.mozRequestAnimationFrame||g.oRequestAnimationFrame||g.msRequestAnimationFrame||function(a){g.setTimeout(a,1E3/ga)}},Aa=Gb(),Hb=function(){E=Date.now();if(pb){var a=d(0,0),b=d(p,q);k.clearRect(a.x,a.y,b.x,b.y)}l.runEvent("preLoop")},Ib=function(){l.runEvent("postLoop");-1!=Ta&&(Sa=E-Ta);Ta=E},S={func:function(){console.log('please, use a "setLoop" function.');
Aa=function(){}},start:!1,end:!1,audio:!1,fps:!1},Jb=function(){if(S.audio)for(var a in S.audio)S.audio[a].stop()};this.game.newLoop=function(a,b){"function"==typeof b?na[a]={func:b,start:!1,end:!1,audio:!1,fps:!1}:ha("error im newLoop: "+b+" is not a function")};this.game.setLoopSound=function(a,b){var c;na[a].audio||(na[a].audio=[]);for(c=0;c<b.length;c++)b[c].setNextPlay(b[c+1==b.length?0:c+1]),na[a].audio.push(b[c])};this.game.setLoop=function(a){if(!na[a])return ha("setLoop: "+a+" is no a Loop");
Jb();zb();ma={};ta={};ea={};va=ua=!1;Cb();hb(d(0,0));S=na[a];S.audio&&S.audio[0].play()};var Kb=function(){if(60>ga){var a=1E3/ga;try{E=Date.now(),E-Fb>a&&(Hb(),S.func(Sa),Fb=E,Ib())}catch(b){sa&&Ca(b),Wa&&(sa||Ca(b),ha())}}else try{Hb(),S.func(Sa),Ib()}catch(b){sa&&Ca(b),Wa&&(sa||Ca(b),ha())}Aa(Kb)},Lb=function(a){ba||(ba=!0,ga=a||60,Aa(Kb))},ha=function(a){if(!ba)return H(r(a)?a:"game is stop");ba=!1;Jb();Aa=function(){H(r(a)?a:"game is stop")}};this.game.getWH=function(){return{w:p,h:q,w2:F,h2:G}};
this.game.startLoop=function(a,b){this.setLoop(a);this.start(b)};this.game.start=Lb;this.game.stop=ha;this.game.resume=function(a){ba||(S.audio&&S.audio[0].play(),H(a||"game is run"),Aa=Gb(),Ta=-1,Lb(ga))};var fc=[],gc=0,ia=function(a,b){b.prototype=Object.create(a.prototype);b.prototype.constructor=b},B=function(a){this.type="BaseObject";this.id=gc++;this.x=a.x||0;this.y=a.y||0;this.w=a.w||0;this.h=a.h||0;this.parent=!1;this.children=[];this.fillColor=a.fillColor||!1;this.strokeColor=a.strokeColor||
v.strokeStyle;this.strokeWidth=a.strokeWidth||0;this.angle=a.angle||0;this.alpha=r(a.alpha)?a.alpha:1;this.center=d(0,0);this.box={x:0,y:0,w:0,h:0};this.visible=r(a.visible)?a.visible:!0;this.flip=d(0,0);this.setShadow(a);a.userData&&this.setUserData(a.userData);a.center&&this.setCenter(a.center);a.box&&this.setBox(a.box);a.position&&this.setPosition(a.position);a.positionC&&this.setPositionC(a.positionC);a.size&&this.setSize(a.size);a.sizeC&&this.setSizeC(a.sizeC);fc.push(this)};B.prototype={getID:function(){return this.id},
getType:function(){return this.type},getParent:function(){return this.parent},addChild:function(a){a&&a.id!=this.id&&(a.parent=this,this.children.push(a),a.move(this.getPosition()),a.setPositionC(I(a.getPositionC(),this.getPositionC(),this.angle)),a.turn(this.angle))},delChild:function(a){a.parent=!1;var b;for(b=0;b<this.children.length;b+=1)if(this.children[b].id==a.id){this.children.splice(b,1);break}},delParent:function(){this.parent.delChild(this)},setBox:function(a){a.offset&&(this.box.x=a.offset.x||
0,this.box.y=a.offset.y||0);a.size&&(this.box.w=a.size.w||0,this.box.h=a.size.h||0)},isArrIntersect:function(a){var b;for(b=0;b<a.length;b++)if(a[b].id!=this.id&&this.isIntersect(a[b]))return a[b];return!1},isArrInside:function(a){var b;for(b=0;b<a.length;b++)if(this.isDynamicInside(a[b].getDynamicBox()))return a[b];return!1},getNearest:function(a){var b,c=0,e=!1;for(b=0;b<a.length;b++)if(this.id!=a[b].id){!1===e&&(e=this.getDistanceC(a[b].getPositionC()),c=b);var d=this.getDistanceC(a[b].getPositionC());
d<e&&(e=d,c=b)}return a[c]},setFlip:function(a,b){r(a)&&this.flip.x!=a&&(this.flip.x=a);r(b)&&this.flip.y!=b&&(this.flip.y=b)},setUserData:function(a){for(var b in a)r(this[b])||(this[b]=a[b])},setShadow:function(a){this.shadowColor=a.shadowColor||!1;this.shadowBlur=r(a.shadowBlur)?a.shadowBlur:3;this.shadowX=a.shadowX||0;this.shadowY=a.shadowY||0},getDynamicBox:function(){var a=this.getPosition(1);return 0==this.angle?[d(this.x+this.box.x,this.y+this.box.y),d(this.x+this.box.x+this.w+this.box.w,
this.y+this.box.y),d(this.x+this.box.x+this.w+this.box.w,this.y+this.box.y+this.h+this.box.h),d(this.x+this.box.x,this.y+this.box.y+this.h+this.box.h)]:[I(d(this.x+this.box.x,this.y+this.box.y),a,this.getAngle()),I(d(this.x+this.box.x+this.w+this.box.w,this.y+this.box.y),a,this.getAngle()),I(d(this.x+this.box.x+this.w+this.box.w,this.y+this.box.y+this.h+this.box.h),a,this.getAngle()),I(d(this.x+this.box.x,this.y+this.box.y+this.h+this.box.h),a,this.getAngle())]},isDynamicIntersect:function(a){if(3>
a.length)return!1;var b=this.getDynamicBox(),c;for(c=0;c<b.length;c++)if(ca(b[c],a))return!0;for(c=0;c<a.length;c++)if(ca(a[c],b))return!0;return!1},isIntersect:function(a){return a.visible?this.angle||a.angle?this.isDynamicIntersect(a.getDynamicBox()):this.isStaticIntersect(a.getStaticBox()):!1},isDynamicInside:function(a){if(3>a.length)return!1;var b=this.getDynamicBox(),c,e=0;for(c=0;c<b.length;c++)ca(b[c],a)&&e++;return e==b.length?!0:!1},drawDynamicBox:function(a){L(this,1);k.shadowColor="transparent";
oa(d(this.x+this.box.x,this.y+this.box.y),z(this.w+this.box.w,this.h+this.box.h),!1,a||"yellow",2);Mb(d(this.x+this.w/2+this.center.x,this.y+this.h/2+this.center.y),10,a||"yellow");J()},drawStaticBox:function(a){k.shadowColor="transparent";oa(d(this.x+this.box.x,this.y+this.box.y),z(this.w+this.box.w,this.h+this.box.h),!1,a||"yellow",2);Mb(d(this.x+this.w/2+this.center.x,this.y+this.h/2+this.center.y),10,a||"yellow")},isStaticIntersect:function(a){return this.y+this.box.y+this.h+this.box.h>=a.y&&
this.x+this.box.x+this.w+this.box.w>=a.x&&this.x+this.box.x<a.x+a.w&&this.y+this.box.y<a.y+a.h},getStaticBox:function(){return{x:this.x+this.box.x,y:this.y+this.box.y,w:this.w+this.box.w,h:this.h+this.box.h}},setAlpha:function(a){this.alpha!=a&&(this.alpha=0<=a?1>=a?a:1:0)},transparent:function(a){this.setAlpha(this.alpha+a)},getAlpha:function(){return this.alpha},rotate:function(a){this.setAngle(Math.atan2(a.y-this.getPosition(1).y,a.x-this.getPosition(1).x)*(180/Math.PI))},setCenter:function(a){this.center=
d(a.x,a.y)},nullCenter:function(a){a||(a=d(0,0));this.center=d(-this.w/2+a.x,-this.h/2+a.y)},getCenter:function(){return d(this.center.x,this.center.y)},getBox:function(){return this.box},move:function(a){this.prevPosition=this.getPosition();"none"!=a.x&&(this.x+=a.x);"none"!=a.y&&(this.y+=a.y);if(this.children.length){var b;for(b=0;b<this.children.length;b+=1)this.children[b].move(a)}},circling:function(a,b,c){r(this.circlingAnglePointJS)||(this.circlingAnglePointJS=0);this.x=a.x+b*Math.cos(u(this.circlingAnglePointJS));
this.y=a.y+b*Math.sin(u(this.circlingAnglePointJS));this.circlingAnglePointJS=360<this.circlingAnglePointJS?0:this.circlingAnglePointJS+c},circlingC:function(a,b,c){r(this.circlingAnglePointJS)||(this.circlingAnglePointJS=0);this.setPositionC(d(a.x+b*Math.cos(u(this.circlingAnglePointJS)),a.y+b*Math.sin(u(this.circlingAnglePointJS))));this.circlingAnglePointJS=360<this.circlingAnglePointJS?0:this.circlingAnglePointJS+c},motion:function(a,b,c){r(this.motionPercentPointJS)||(this.motionPercentPointJS=
0);this.x=a.x+b.w*Math.cos(u(this.motionPercentPointJS));this.y=a.y+b.h*Math.sin(u(this.motionPercentPointJS));this.motionPercentPointJS=360<this.motionPercentPointJS?0:this.motionPercentPointJS+c},motionC:function(a,b,c){r(this.motionPercentPointJS)||(this.motionPercentPointJS=0);this.setPositionC(d(a.x+b.w*Math.cos(u(this.motionPercentPointJS)),a.y+b.h*Math.sin(u(this.motionPercentPointJS))));this.motionPercentPointJS=360<this.motionPercentPointJS?0:this.motionPercentPointJS+c},scale:function(a){"none"!=
a.w&&(this.w+=a.w);"none"!=a.h&&(this.h+=a.h)},scaleC:function(a){this.scale(a);this.move(d(-(a.w/2),-(a.h/2)))},getPosition:function(a){return 1==a?d(this.x+(this.w/2+this.center.x),this.y+(this.h/2+this.center.y)):2==a?(a=d(this.x+this.w/2,this.y+this.h/2),this.angle&&(a=I(a,this.getPosition(1),this.angle)),d(a.x,a.y)):d(this.x,this.y)},getPositionC:function(){return d(this.x+(this.w/2+this.center.x),this.y+(this.h/2+this.center.y))},getPositionS:function(){return d(this.x+f.x,this.y+f.x)},getPositionCS:function(){return d(this.x+
(this.w/2+this.center.x)+f.x,this.y+(this.h/2+this.center.y)+f.y)},setPosition:function(a){var b=this.getPosition();"none"!=a.x&&(this.x=a.x);"none"!=a.y&&(this.y=a.y);if(this.children.length)for(a=0;a<this.children.length;a+=1)this.children[a].move(d(-b.x+this.x,-b.y+this.y))},setPositionS:function(a){var b=this.getPosition();"none"!=a.x&&(this.x=a.x+f.x);"none"!=a.y&&(this.y=a.y+f.y);if(this.children.length)for(a=0;a<this.children.length;a+=1)this.children[a].move(d(-b.x+this.x,-b.y+this.y))},setPositionC:function(a){var b=
this.getPosition();"none"!=a.x&&(this.x=-(this.w/2+this.center.x)+a.x);"none"!=a.y&&(this.y=-(this.h/2+this.center.y)+a.y);if(this.children.length)for(a=0;a<this.children.length;a+=1)this.children[a].move(d(-b.x+this.x,-b.y+this.y))},setPositionCS:function(a){var b=this.getPosition();"none"!=a.x&&(this.x=-(this.w/2+this.center.x)+a.x+f.x);"none"!=a.y&&(this.y=-(this.h/2+this.center.y)+a.y+f.y);if(this.children.length)for(a=0;a<this.children.length;a+=1)this.children[a].move(d(-b.x+this.x,-b.y+this.y))},
getSize:function(){return z(this.w,this.h)},setSize:function(a){"none"!=a.w&&(this.w=a.w);"none"!=a.h&&(this.h=a.h)},setSizeC:function(a){"none"!=a.w&&(this.w=a.w,this.move(d(-(a.w/2),"none")));"none"!=a.h&&(this.h=a.h,this.move(d("none",-(a.h/2))))},turn:function(a){this.angle=360<this.angle?0:this.angle;this.angle=0>this.angle?360:this.angle;this.angle+=a;if(this.children.length){var b;for(b=0;b<this.children.length;b+=1)this.children[b].turn(a)}},rotateForAngle:function(a,b){var c=Math.abs(a);
90>Math.abs(this.angle)||180-c<=2*b&&this.setAngle(a);this.angle<a?this.turn(b):this.turn(-b)},moveTo:function(a,b){var c=vb(this.getPositionC(),a);this.prevPosition=this.getPosition();this.x+=b*Math.cos(u(c));this.y+=b*Math.sin(u(c))},moveAngle:function(a,b){this.prevPosition=this.getPosition();this.x+=a*Math.cos(u(r(b)?b:this.angle));this.y+=a*Math.sin(u(r(b)?b:this.angle))},moveTime:function(a,b){b=b||1;var c=this.getPosition();this.move(d((a.x-c.x)/b,(a.y-c.y)/b))},moveTimeC:function(a,b){b=b||
1;var c=this.getPosition(1);this.move(d((a.x-c.x)/b,(a.y-c.y)/b))},movePoint:function(a,b){},movePointC:function(a,b){},getAngle:function(){return this.angle},setAngle:function(a){this.angle!=a&&(this.angle=a%360);if(this.children.length){var b;for(b=0;b<this.children.length;b+=1)this.children[b].turn(a)}},getDistance:function(a){return Math.sqrt(Math.pow(a.x-this.getPosition(2).x,2)+Math.pow(a.y-this.getPosition(2).y,2))},getDistanceC:function(a){return Math.sqrt(Math.pow(a.x-this.getPosition(1).x,
2)+Math.pow(a.y-this.getPosition(1).y,2))},setVisible:function(a){this.visible=1==a},isVisible:function(){return this.visible},isInCamera:function(){return this.angle?this.isInCameraDynamic():this.isInCameraStatic()},isInCameraStatic:function(){return this.x+this.w<f.x||this.x>f.x+p||this.y+this.h<f.y||this.y>f.y+q?!1:!0},isInCameraDynamic:function(){var a=this.getDynamicBox(),b=[d(f.x,f.y),d(f.x+p,f.y),d(f.x+p,f.y+q),d(f.x,f.y+q)],c,e=0;for(c=0;c<a.length;c++)ca(a[c],b)&&e++;return 0<e},onCollision:function(a){},
onArrCollision:function(a){var b;for(b=0;b<a.length;b++)if(this.id!=a[b].id)this.onCollision(a[b])},draw:function(){}};this.game.newBaseObject=function(a){return new B(a)};var ib=function(a){B.call(this,a);this.type="RectObject"};ia(B,ib);ib.prototype.draw=function(){if(this.visible&&this.alpha){var a=!1;if(this.angle||1!=this.alpha)L(this),a=!0;oa(d(this.x,this.y),z(this.w,this.h),this.fillColor,this.strokeColor,this.strokeWidth);a&&J()}};this.game.newRectObject=function(a){return new ib(a)};var ja=
function(a){B.call(this,a);this.radius=a.radius||5;this.w=2*this.radius;this.h=2*this.radius;this.type="CircleObject";a.positionC&&this.setPositionC(a.positionC)};ia(B,ja);ja.prototype.draw=function(){if(this.visible&&this.alpha){var a=!1;if(this.angle||1!=this.alpha)L(this),a=!0;pa(d(this.x,this.y),this.radius,this.fillColor,this.strokeColor,this.strokeWidth);a&&J()}};ja.prototype.scale=function(a){this.w+=a||0;this.h+=a||0;this.radius+=a?a/2:0};ja.prototype.scaleC=function(a){this.w+=a||0;this.h+=
a||0;this.radius+=a?a/2:0;this.move(d(-(a/2),-(a/2)))};ja.prototype.getRadius=function(){return this.radius};ja.prototype.setRadius=function(a){a&&this.radius!=a&&(this.radius=a,this.w=2*a,this.h=2*a)};this.game.newCircleObject=function(a){return new ja(a)};var jb=function(a){this.file=a.file;this.w=a.w;this.h=a.h;this.countX=a.countX;this.countY=a.countY;this.fullW=this.countX*this.w;this.fullH=this.countY*this.h;this.cnv=g.document.createElement("canvas");this.cnv.width=this.w;this.cnv.height=this.h;
this.ctx=this.cnv.getContext("2d");this.loaded=!1;this.x=a.x>>0;this.y=a.y>>0;a=g.document.createElement("img");var b=this;a.onload=function(){b.ctx.drawImage(this,0,0,b.w,b.h);b.loaded=!0;w.load()};a.src=this.file;w.add()};jb.prototype.draw=function(){if(this.loaded){var a=-f.x+this.x,b=-f.y+this.y,c,e;for(e=0;e<this.countY;e++)if(!(e*this.h+this.h<f.y||e*this.h>f.y+q))for(c=0;c<this.countX;c++)c*this.w+this.w<f.x||c*this.w>f.x+p||k.drawImage(this.cnv,a+c*this.w,b+e*this.h,this.w,this.h)}};jb.prototype.getSize=
function(){return this.loaded?z(this.fullW,this.fullH):z()};this.game.newBackgroundObject=function(a){return new jb(a)};var kb=function(a){B.call(this,a);this.type="EllipsObject"};ia(B,kb);kb.prototype.draw=function(){this.visible&&this.alpha&&(L(this),pa(d(this.x,this.y),this.h/2,this.fillColor,this.strokeColor,this.strokeWidth),J())};this.game.newEllipsObject=function(a){return new kb(a)};var T=function(a){B.call(this,a);this.type="TextObject";this.text=a.text||"TextObject";this.color=a.color||
"";this.size=a.size||10;this.font=a.font||"sans-serif";this.style=a.style||"";this.align="left";this.padding=a.padding||2;this.w=lb(this.text,this.style,this.size,this.font)+2*this.padding;this.h=this.size+2*this.padding;this.strokeColorText=a.strokeColorText||!1;this.strokeWidthText=a.strokeWidthText||!1;this.textDY=-this.size/7;a.positionC&&this.setPositionC(a.positionC)};ia(B,T);T.prototype.reStyle=function(a){this.text=a.text||this.text;this.color=a.color||this.color;this.size=a.size||this.size;
this.font=a.font||this.font;this.style=a.style||this.style;this.padding=a.padding||this.padding;this.w=lb(this.text,this.style,this.size,this.font)+2*this.padding;this.h=this.size+2*this.padding;this.strokeColorText=a.strokeColorText||this.strokeColorText;this.strokeWidthText=a.strokeWidthText||this.strokeWidthText;this.strokeColor=a.strokeColor||this.strokeColor;this.strokeWidth=a.strokeWidth||this.strokeWidth;this.fillColor=a.fillColor||this.fillColor;this.textDY=-this.size/7};T.prototype.setText=
function(a){this.text!=a&&this.reStyle({text:a})};T.prototype.getText=function(){return this.text};T.prototype.draw=function(){if(this.visible&&this.alpha){var a=!1;if(this.angle||1!=this.alpha)L(this),a=!0;(this.fillColor||this.strokeColor)&&oa(d(this.x,this.y),z(this.w,this.h),this.fillColor,this.strokeColor,this.strokeWidth);Ba(d(this.x+this.padding,this.textDY+this.y+this.padding),this.text,this.color,this.size,this.font,this.style,this.align,this.strokeColorText,this.strokeWidthText);a&&J()}};
T.prototype.scale=function(a){this.reStyle({size:this.size+a})};T.prototype.scaleC=function(a){this.reStyle({size:this.size+a});this.move(d(-a/2,-a/2))};T.prototype.setSize=function(a){this.size!=a&&this.reStyle({size:a})};T.prototype.setSizeC=function(a){this.size!=a&&(this.reStyle({size:a}),this.move(d(-a/2,-a/2)))};var lb=function(a,b,c,e){var d=g.document.createElement("canvas").getContext("2d");d.font=b+c+"px "+e;return d.measureText(a).width};this.OOP.getTextWidth=function(a){return lb(a.text,
a.style||"",a.size||10,a.font||"sans-serif")};this.game.newTextObject=function(a){return new T(a)};var M=function(a){B.call(this,a);this.type="PolygonObject";this.points=[];this.dX=this.dY=0;var b;if(a.points)for(b in a.points)this.addPoint(a.points[b]);this.pointColor=a.pointColor||!1};ia(B,M);M.prototype.addPoint=function(a){this.dY=this.dX=0;var b;if(this.y+a.y<this.y)for(b in this.dY=Math.abs(this.y+a.y-this.y),this.points)this.points[b].y+=this.dY;if(this.x+a.x<this.x)for(b in this.dX=Math.abs(this.x+
a.x-this.x),this.points)this.points[b].x+=this.dX;this.points.push(d(a.x+this.dX,a.y+this.dY));this.h=this.w=0;for(b in this.points)this.h+=this.y+this.points[b].y>this.y+this.h?this.points[b].y-this.h:0,this.w+=this.x+this.points[b].x>this.x+this.w?this.points[b].x-this.w:0};M.prototype.delPoint=function(a){var b,c=this.getPoints();this.clearPoints();for(b=0;b<c.length;b++)b!=a&&this.addPoint(c[b])};M.prototype.clearPoints=function(){this.points=[];this.count=0};M.prototype.getPoints=function(){return this.points};
M.prototype.getCount=function(){return this.points.length};M.prototype.getPoint=function(a){return this.points[a]};M.prototype.scale=function(a){};M.prototype.drawDynamicBox=function(a){var b=!1;if(this.angle||1!=this.alpha)L(this),b=!0;Nb(this.x,this.y,this.points,this.fillColor,a||"yellow",2,"red");b&&J()};M.prototype.getDynamicBox=function(){var a=[],b;if(this.angle){var c=this.getPosition(1);for(b in this.points)a.push(I(ka(this.points[b],d(this.x,this.y)),c,this.getAngle()))}else for(b in this.points)a.push(ka(this.points[b],
d(this.x,this.y)));return a};M.prototype.draw=function(){if(this.visible&&this.alpha){var a=!1;if(this.angle||1!=this.alpha)L(this),a=!0;Nb(this.x,this.y,this.points,this.fillColor,this.strokeColor,this.strokeWidth,this.pointColor);a&&J()}};this.game.newPolygonObject=function(a){return new M(a)};var qa=function(a){B.call(this,a);this.type="ImageObject";this.w=a.w||0;this.h=a.h||0;this.loaded=!1;this.file="";this.forOnLoad=a.onload||!1;Ob(a.file,this,a.scale||1)};ia(B,qa);qa.prototype.draw=function(){if(this.visible&&
this.alpha&&this.loaded){var a=!1;if(this.angle||1!=this.alpha||this.shadowColor||this.flip.x||this.flip.y)L(this),a=!0;Pb(d(this.x,this.y),z(this.w,this.h),this.file);a&&J()}};qa.prototype.simpleDraw=function(a){if(this.loaded){var b=!1;if(this.angle||1!=this.alpha)L(this),b=!0;Pb(d(a.x,a.y),z(this.w,this.h),this.file);b&&J()}};qa.prototype.setImage=function(a,b){this.file!=a&&(r(m[a])?this.file=a:(this.loaded=!1,this.origHeight=this.origWidth=0,Ob(a,this)))};qa.prototype.getImage=function(){return this.file};
this.game.newImageObject=function(a){return new qa(a)};var Q=function(a){B.call(this,a);this.type="AnimationObject";this.frame=0;this.anim=a.animation;this.step=a.delay||10;this.toFrameStep=this.difStep=0;a.scale&&(this.w*=a.scale,this.h*=a.scale)};ia(B,Q);Q.prototype.draw=function(){if(this.visible&&this.alpha){var a=!1;if(this.angle||1!=this.alpha||this.flip.x||this.flip.y)L(this),a=!0;mb(this.anim,d(this.x,this.y),z(this.w,this.h),this.frame);this.difStep>this.step?(this.frame=this.frame<this.anim.r?
this.frame+1:0,this.difStep=0):this.difStep++;a&&J()}};Q.prototype.drawFrames=function(a,b,c){if(this.visible&&this.alpha){c=!1;if(this.angle||1!=this.alpha||this.flip.x||this.flip.y)L(this),c=!0;mb(this.anim,d(this.x,this.y),z(this.w,this.h),this.frame);this.difStep>this.step?(this.frame=this.frame<b?this.frame+1:a,this.difStep=0):this.difStep++;c&&J()}};Q.prototype.drawFrame=function(a){if(this.visible&&this.alpha){var b=!1;if(this.angle||1!=this.alpha||this.flip.x||this.flip.y)L(this),b=!0;mb(this.anim,
d(this.x,this.y),z(this.w,this.h),a);b&&J()}};Q.prototype.drawToFrame=function(a){if(this.visible&&this.alpha){if(this.frame<a)this.toFrameStep=1;else if(this.frame>a)this.toFrameStep=-1;else{this.drawFrame(a);return}this.drawFrame(this.frame);this.difStep>this.step?(this.frame=this.frame<this.anim.r?this.frame+this.toFrameStep:0,this.difStep=0):this.difStep++}};Q.prototype.drawReverFrames=function(a,b){this.visible&&this.alpha&&(this.drawFrame(this.frame),this.difStep>this.step?(this.frame<=a?this.toFrameStep=
1:this.frame>=b&&(this.toFrameStep=-1),this.frame=this.frame<=this.anim.r?this.frame+this.toFrameStep:0,this.difStep=0):this.difStep++)};Q.prototype.setAnimation=function(a){this.anim=a};Q.prototype.getAnimation=function(){return this.anim};Q.prototype.setDelay=function(a){this.step=0<a?a:this.step};Q.prototype.getDelay=function(){return this.step};this.game.newAnimationObject=function(a){return new Q(a)};var ra=function(a){this.file=a;this.loaded=!1;this.h=this.w=0;this.toLoad=[];var b=g.document.createElement("img"),
c=this;b.onload=function(){c.loaded=!0;c.w=this.width;c.h=this.height;c.img=g.document.createElement("canvas");c.img.width=this.width;c.img.height=this.height;c.context=c.img.getContext("2d");c.context.drawImage(this,0,0);c.toLoad.length&&Eb(c.toLoad,function(a){a.func(c.context,a.w,a.h,a.r)});w.load()};b.src=a;w.add()};ra.prototype.onContext=function(a){this.loaded?a(this.context,this.w,this.h,1):this.toLoad.push({w:this.w,h:this.h,r:1,func:a})};ra.prototype.getAnimation=function(a,b,c,e,d){var f=
function(a,b,c,e,d,f){this.image=a;this.x=b;this.y=c;this.w=e;this.h=d;this.r=f?f-1:0};f.prototype={onContext:function(a){this.image.loaded?a(this.image.context,this.w,this.h,this.r):this.image.toLoad.push({w:this.w,h:this.h,r:this.r,func:a})},getImage:function(){return this.image},getCount:function(){return this.r}};return new f(this,a,b,c,e,d)};var nb=function(a,b){this.loaded=!0;this.w=a;this.h=b;this.img=g.document.createElement("canvas");this.img.width=a;this.img.height=b;this.context=this.img.getContext("2d")};
nb.prototype.onContext=ra.prototype.onContext;nb.prototype.getAnimation=ra.prototype.getAnimation;this.tiles.newDrawImage=function(a,b){return new nb(a,b)};this.tiles.newImage=function(a){return new ra(a)};this.tiles.newAnimation=function(a,b,c,e){return(new ra(a)).getAnimation(0,0,b,c,e)};var mb=function(a,b,c,e){a.image.loaded&&k.drawImage(a.image.img,a.x+a.w*e,a.y,a.w,a.h,b.x+-f.x,b.y+-f.y,c.w,c.h)},m={},Ob=function(a,b,c){if(r(m[a])){b.loaded=!0;b.file=a;var e,d;if(b.w&&!b.h){var f=b.w/m[a].w;
e=b.w;d=m[a].h*f}else!b.w&&b.h?(f=b.h/m[a].h,d=b.h,e=m[a].w*f):b.w&&b.h?(e=b.w,d=b.h):(e=m[a].w,d=m[a].h);c&&(e*=c,d*=c);b.w=e;b.h=d}else e=g.document.createElement("img"),e.onload=function(){m[a]={};m[a].img=this;m[a].w=this.width;m[a].h=this.height;if(r(b)){b.loaded=!0;var e,d;if(b.w&&!b.h){var f=b.w/m[a].w;e=b.w;d=m[a].h*f}else!b.w&&b.h?(f=b.h/m[a].h,d=b.h,e=m[a].w*f):b.w&&b.h?(e=b.w,d=b.h):(e=m[a].w,d=m[a].h);c&&(e*=c,d*=c);b.w=e;b.h=d;b.file=a;b.forOnLoad&&b.forOnLoad()}w.load()},e.src=a,w.add()},
Pb=function(a,b,c){c&&k.drawImage(m[c].img,0,0,m[c].w,m[c].h,a.x+-f.x,a.y+-f.y,b.w,b.h)},Qb=function(a){this.type="Mesh";this.objs=[];this.x=a.x||0;this.y=a.y||0;this.angle=a.angle||0;this.count=0;if(a.add)for(var b in a.add)this.add(a.add[b]);this.angle&&this.setAngle(this.angle)};Qb.prototype={getCount:function(){return this.count},add:function(a){this.count++;this.objs.push(a);a.offsetMesh=a.getPosition(1);a.turn(this.angle);a.setPositionC(d(this.x+a.offsetMesh.x,this.y+a.offsetMesh.y))},del:function(a){for(var b in this.objs)this.objs[b]==
a&&(this.objs.splice(b,1),this.count--)},draw:function(a){for(var b in this.objs)this.objs[b].draw()},move:function(a){this.x+=a.x||0;this.y+=a.y||0;for(var b in this.objs)a=this.objs[b],a.setPositionC(d(this.x+a.offsetMesh.x,this.y+a.offsetMesh.y))},turn:function(a){if(0!=a){this.angle%=360;this.angle+=a;var b,c,e=d(this.x,this.y);for(b in this.objs)c=this.objs[b],c.turn(a),c.setPositionC(I(d(this.x+c.offsetMesh.x,this.y+c.offsetMesh.y),e,this.angle))}},setAngle:function(a){if(a!=this.angle){this.angle=
a%=360;var b,c,e=d(this.x,this.y);for(b in this.objs)c=this.objs[b],c.setAngle(a),c.setPositionC(I(d(this.x+c.offsetMesh.x,this.y+c.offsetMesh.y),e,this.angle))}},setPosition:function(a){if(this.x!=a.x||this.y!=a.y){this.x=a.x||this.x;this.y=a.y||this.y;for(var b in this.objs)a=this.objs[b],this.angle?a.setPositionC(I(d(this.x+a.offsetMesh.x,this.y+a.offsetMesh.y),d(this.x,this.y),this.angle)):a.setPositionC(d(this.x+a.offsetMesh.x,this.y+a.offsetMesh.y))}},isDynamicIntersect:function(a){if(3>a.length)return!1;
var b,c;for(b in this.objs)if(c=this.objs[b],c.isDynamicIntersect(a))return c;return!1},isStaticIntersect:function(a){var b,c;for(b in this.objs)if(c=this.objs[b],c.isStaticIntersect(a))return c;return!1},isIntersect:function(a){var b,c;for(b in this.objs)if(c=this.objs[b],c.isIntersect(a))return c;return!1}};this.game.newMesh=function(a){return new Qb(a)};this.camera.circling=function(a,b,c){r(this.circlingAnglePointJS)||(this.circlingAnglePointJS=c);f.x=a.x+b*Math.cos(u(this.circlingAnglePointJS));
f.y=a.y+b*Math.sin(u(this.circlingAnglePointJS));this.circlingAnglePointJS=360<=this.circlingAnglePointJS?c:this.circlingAnglePointJS+c};this.camera.circlingC=function(a,b,c){r(this.circlingAnglePointJS)||(this.circlingAnglePointJS=c);f.x=-F+a.x+b*Math.cos(u(this.circlingAnglePointJS));f.y=-G+a.y+b*Math.sin(u(this.circlingAnglePointJS));this.circlingAnglePointJS=360<=this.circlingAnglePointJS?c:this.circlingAnglePointJS+c};this.camera.motion=function(a,b,c){r(this.motionPercentPointJS)||(this.motionPercentPointJS=
b);f.x=a.x+b.w*Math.cos(u(this.motionPercentPointJS));f.y=a.y+b.h*Math.sin(u(this.motionPercentPointJS));this.motionPercentPointJS=360<=this.motionPercentPointJS?b:this.motionPercentPointJS+c};this.camera.motionC=function(a,b,c){r(this.motionPercentPointJS)||(this.motionPercentPointJS=b);this.setPositionC(d(a.x+b.w*Math.cos(u(this.motionPercentPointJS)),a.y+b.h*Math.sin(u(this.motionPercentPointJS))));this.motionPercentPointJS=360<=this.motionPercentPointJS?b:this.motionPercentPointJS+c};this.camera.move=
function(a){f.x+=a.x||0;f.y+=a.y||0};this.camera.moveTime=function(a,b){b=b||1;var c=d(f.x,f.y);this.move(d((a.x-c.x)/b,(a.y-c.y)/b))};this.camera.moveTimeC=function(a,b){b=b||1;var c=d(f.x+F,f.y+G);this.move(d((a.x-c.x)/b,(a.y-c.y)/b))};this.camera.setPosition=function(a){hb(d("none"!=a.x?a.x:f.x,"none"!=a.y?a.y:f.y))};this.camera.setPositionC=function(a){hb(d("none"!=a.x?a.x-F:f.x,"none"!=a.y?a.y-G:f.y))};this.camera.getPosition=function(a){return a?d(f.x+F,f.y+G):d(f.x,f.y)};this.camera.getPositionC=
function(){return d(f.x+F,f.y+G)};this.camera.getStaticBox=function(){return{x:f.x,y:f.y,w:f.x+p,h:f.y+q}};this.camera.getDynamicBox=function(){return[d(f.x,f.y),d(f.x+p,f.y),d(f.x+p,f.y+q),d(f.x,f.y+q)]};var hb=function(a){f=d(a.x,a.y)},J=function(a){k.restore();k.globalAlpha=v.globalAlpha},L=function(a,b){k.save();var c=a.getPosition(1);a.angle&&(k.translate(-f.x+c.x,-f.y+c.y),k.rotate(u(a.angle)),k.translate(-c.x+f.x,-c.y+f.y));1!=a.alpha&&(k.globalAlpha=a.alpha);if(a.flip.x||a.flip.y)k.translate(-f.x+
c.x,-f.y+c.y),k.scale(a.flip.x?-1:1,a.flip.y?-1:1),k.translate(-c.x+f.x,-c.y+f.y);a.shadowColor&&(k.shadowBlur=a.shadowBlur,k.shadowColor=a.shadowColor,k.shadowOffsetX=a.shadowX,k.shadowOffsetY=a.shadowY);if("EllipsObject"==a.type&&!b){var c=a.w/2,e=a.h/2,g=d(-f.x+a.x,-f.y+a.y);k.translate(g.x,g.y);k.scale(c/e,1);k.translate(-g.x,-g.y)}};this.system.setContextSettings=function(a){k.save();for(var b in a)k[b]=a[b]};this.system.defaultSettings=function(){J()};this.game.clear=function(){var a=d(0,0),
b=d(p,q);k.clearRect(a.x,a.y,b.x,b.y)};this.game.fill=function(a){da(a||"white");k.fillRect(0,0,p,q)};var Nb=function(a,b,c,e,g,h,l){if(!(3>c.length)){var m;if(e&&!(3>c.length)){da(e);e=-f.x+a;m=-f.y+b;var n;k.beginPath();k.moveTo(e+c[0].x,m+c[0].y);for(n=1;n<c.length;n++)k.lineTo(e+c[n].x,m+c[n].y);k.closePath();k.fill()}for(e=0;e<c.length;e++)m=e+1<c.length?e+1:0,g&&U(ka(c[e],d(a,b)),ka(c[m],d(a,b)),g,h),l&&Ua(ka(c[e],d(a,b)),l)}};this.brush.drawPolygon=function(a){var b=a.points||[],c=a.fillColor||
!1,e=a.strokeColor||!1,d=a.strokeWidth||1;a=a.pointColor||!1;if(!(3>b.length)){var g;if(c&&!(3>b.length)){da(c);c=-f.x;g=-f.y;var h;k.beginPath();k.moveTo(c+b[0].x,g+b[0].y);for(h=1;h<b.length;h++)k.lineTo(c+b[h].x,g+b[h].y);k.closePath();k.fill()}for(c=0;c<b.length;c++)g=c+1<b.length?c+1:0,e&&U(b[c],b[g],e,d),a&&Ua(b[c],a)}};var Ba=function(a,b,c,e,d,g,h,l,m){k.textAlign=h;k.lineWidth=m;k.font=(g?g+" ":"")+e+"px "+d;e=-f.x;d=-f.y;c&&(da(c),k.fillText(b,e+a.x,d+a.y));l&&(Da(l),k.strokeText(b,e+a.x,
d+a.y))};this.brush.drawText=function(a){Ba(d(a.x||0,a.y||0),a.text,a.color||!1,a.size||10,a.font||v.font,a.style||!1,a.align||"left",a.strokeColorText||!1,a.strokeWidthText||2)};this.brush.drawTextS=function(a){Ba(d((a.x||0)+f.x,(a.y||0)+f.y),a.text,a.color||v.fillStyle,a.size||10,a.font||v.font,a.style||!1,a.align||"left",a.strokeColor||!1,a.strokeWidth||2)};this.brush.drawTextLines=function(a){if(a.lines){var b;for(b=0;b<a.lines.length;b++)Ba(d(a.x,a.y+a.size*b),a.lines[b],a.color||v.fillStyle,
a.size||10,a.font||v.font,a.style||!1,a.align||"left",a.strokeColor||!1,a.strokeWidth||2)}};this.brush.drawTextLinesS=function(a){if(a.lines){var b;for(b=0;b<a.lines.length;b++)Ba(d(a.x+f.x,a.y+f.y+a.size*b),a.lines[b],a.color||v.fillStyle,a.size||10,a.font||v.font,a.style||!1,a.align||"left",a.strokeColor||!1,a.strokeWidth||2)}};var Mb=function(a,b,c){U(d(a.x-b,a.y),d(a.x+b,a.y),c,2);U(d(a.x,a.y-b),d(a.x,a.y+b),c,2)},oa=function(a,b,c,e,d){da(c);Da(e);k.lineWidth=d;e=-f.x+(d?d/2:0);var g=-f.y+(d?
d/2:0);c&&k.fillRect(a.x+e,a.y+g,b.w,b.h);d&&k.strokeRect(a.x+e,a.y+g,b.w,b.h)};this.brush.drawRect=function(a){oa(d(a.x,a.y),z(a.w,a.h),a.fillColor||!1,a.strokeColor||v.strokeStyle,a.strokeWidth||!1)};this.brush.drawRectS=function(a){oa(d(a.x+f.x,a.y+f.y),z(a.w,a.h),a.fillColor||!1,a.strokeColor||v.strokeStyle,a.strokeWidth||!1)};var Ua=function(a,b){da(b);b&&k.fillRect(-f.x+a.x-1,-f.y+a.y-1,2,2)};this.brush.drawPoint=function(a){Ua(d(a.x,a.y),a.fillColor||!1)};this.brush.drawPointS=function(a){Ua(d(a.x+
f.x,a.y+f.y),a.fillColor||!1)};var pa=function(a,b,c,e,d){da(c);Da(e);k.lineWidth=d;e=-f.x+b+(d?d/2:0);var g=-f.y+b+(d?d/2:0);k.beginPath();k.arc(a.x+e,a.y+g,b,0,2*Math.PI,!0);k.closePath();c&&k.fill();d&&k.stroke()};this.brush.drawCircle=function(a){pa(d(a.x,a.y),a.radius,a.fillColor||!1,a.strokeColor||v.strokeStyle,a.strokeWidth||!1)};this.brush.drawCircleS=function(a){pa(d(a.x+f.x,a.y+f.y),a.radius,a.fillColor||!1,a.strokeColor||v.strokeStyle,a.strokeWidth||!1)};var U=function(a,b,c,e){Da(c);k.lineWidth=
e;c=-f.x;e=-f.y;k.beginPath();k.moveTo(c+a.x,e+a.y);k.lineTo(c+b.x,e+b.y);k.closePath();k.stroke()};this.brush.drawLineAngle=function(a){var b=I(d(a.x+a.length,a.y),d(a.x,a.y),a.angle);U(d(a.x,a.y),d(b.x,b.y),a.strokeColor||v.strokeStyle,a.strokeWidth||1)};this.brush.drawLineAngleS=function(a){var b=I(d(f.x+a.x+a.length,f.y+a.y),d(f.x+a.x,f.y+a.y),a.angle);U(d(f.x+a.x,f.y+a.y),d(b.x,b.y),a.strokeColor||v.strokeStyle,a.strokeWidth||1)};this.brush.drawLine=function(a){U(d(a.x1,a.y1),d(a.x1+a.x2,a.y1+
a.y2),a.strokeColor||v.strokeStyle,a.strokeWidth||1)};this.brush.drawLineS=function(a){U(d(f.x+a.x1,f.y+a.y1),d(f.x+a.x2,f.y+a.y2),a.strokeColor||v.strokeStyle,a.strokeWidth||1)};this.brush.drawLineA=function(a){U(d(a.x1,a.y1),d(a.x2,a.y2),a.strokeColor||v.strokeStyle,a.strokeWidth||1)};this.brush.drawLineAS=function(a){U(d(a.x1+f.x,a.y1+f.y),d(a.x2+f.x,a.y2+f.y),a.strokeColor||v.strokeStyle,a.strokeWidth||1)};this.brush.drawEllips=function(a){var b=a.w/2,c=a.h/2,e=d(-f.x+a.x,-f.y+a.y);k.save();k.translate(e.x,
e.y);k.scale(b/c,1);k.translate(-e.x,-e.y);pa(d(a.x,a.y),c,a.fillColor,a.strokeColor,a.strokeWidth);k.restore()};this.brush.drawEllipsS=function(a){var b=a.w/2,c=a.h/2,e=d(a.x,a.y);k.save();k.translate(e.x,e.y);k.scale(b/c,1);k.translate(-e.x,-e.y);pa(d(f.x+a.x,f.y+a.y),c,a.fillColor,a.strokeColor,a.strokeWidth);k.restore()};this.brush.drawImageS=function(a){if(a.file)if(r(m[a.file])){if(m[a.file].loaded){var b=a.x||0,c=a.y||0,e,d;if(a.w&&!a.h){var f=a.w/m[a.file].w;e=a.w;d=m[a.file].h*f}else!a.w&&
a.h?(f=a.h/m[a.file].h,d=a.h,e=m[a.file].w*f):a.w&&a.h?(e=a.w,d=a.h):(e=m[a.file].w,d=m[a.file].h);a.scale&&(e*=a.scale,d*=a.scale);k.drawImage(m[a.file].img,0,0,m[a.file].w,m[a.file].h,b,c,e,d)}}else m[a.file]={},m[a.file].loaded=!1,b=g.document.createElement("img"),b.onload=function(){m[a.file].loaded=!0;m[a.file].img=this;m[a.file].w=this.width;m[a.file].h=this.height;w.load()},b.src=a.file,w.add()};this.brush.drawImage=function(a){if(a.file)if(r(m[a.file])){if(m[a.file].loaded){var b=a.x||0,c=
a.y||0,e,d;if(a.w&&!a.h){var h=a.w/m[a.file].w;e=a.w;d=m[a.file].h*h}else!a.w&&a.h?(h=a.h/m[a.file].h,d=a.h,e=m[a.file].w*h):a.w&&a.h?(e=a.w,d=a.h):(e=m[a.file].w,d=m[a.file].h);a.scale&&(e*=a.scale,d*=a.scale);k.drawImage(m[a.file].img,0,0,m[a.file].w,m[a.file].h,-f.x+b,-f.y+c,e,d)}}else m[a.file]={},m[a.file].loaded=!1,b=g.document.createElement("img"),b.onload=function(){m[a.file].loaded=!0;m[a.file].img=this;m[a.file].w=this.width;m[a.file].h=this.height;w.load()},b.src=a.file,w.add()};this.brush.getPixelColor=
function(a,b){var c=k.getImageData(a,b,1,1).data;return"rgb("+c[0]+", "+c[1]+", "+c[2]+")"};this.brush.setPixelColor=function(a,b,c){var e=k.createImageData(1,1);e.data[0]=c.r||e.data[0];e.data[1]=c.g||e.data[1];e.data[2]=c.b||e.data[2];e.data[3]=c.a||255;k.putImageData(e,a,b)};this.brush.onPixel=function(a,b,c){var e=k.getImageData(a,b,1,1),d={r:e.data[0],g:e.data[1],b:e.data[2],a:e.data[3]?e.data[3]:255};c(d);e.data[0]=d.r;e.data[1]=d.g;e.data[2]=d.b;e.data[3]=d.a;k.putImageData(e,a,b)};this.brush.onPixels=
function(a,b,c,e,d){c=k.getImageData(a,b,c,e);var f;e=0;for(f=c.data.length;e<f;e+=4){var g={r:c.data[e],g:c.data[e+1],b:c.data[e+2],a:c.data[e+3]?c.data[e+3]:255};d(g);c.data[e]=g.r;c.data[e+1]=g.g;c.data[e+2]=g.b;c.data[e+3]=g.a}k.putImageData(c,a,b)};this.brush.onRawPixels=function(a,b,c,e,d){c=k.getImageData(a,b,c,e);d(c.data,c.data.length);k.putImageData(c,a,b)};var N=g.AudioContext||g.webkitAudioContext||!1;(N=N?new N:!1)&&N.listener.setPosition(0,0,0);var O=function(a,b){N||H('module "wAudio" is not supported! use a "audio"');
this.vol=b&&1>=b&&0<b?b:1;this.loadPLay=this.nextPlay=this.loaded=this.playing=!1;this.pausedTime=this.duration=this.startTime=0;var c=this,e=new XMLHttpRequest;e.open("GET",a,!0);e.responseType="arraybuffer";e.onload=function(a){N.decodeAudioData(this.response,function(a){c.wABuffer=a;c.duration=c.wABuffer.duration;c.wAGain=N.createGain();c.wAGain.gain.value=c.vol;c.wAPanner=N.createPanner();c.wAPanner.setPosition(0,0,1);c.wAPanner.panningModel="equalpower";w.load();c.loaded=!0;c.loadPlay&&c.replay()},
function(a){H("error in wAudio.newAudio: error decoding file",a)})};a?e.send():H("error in wAudio.newAudio: Where is file?");w.add()};O.prototype.play=function(a){if(!this.loaded)this.loadPlay=!0;else if(!this.playing){this.playing=!0;this.wASource=N.createBufferSource();this.wASource.buffer=this.wABuffer;this.wAListener=N.destination;this.wASource.connect(this.wAGain);this.wAGain.connect(this.wAPanner);this.wAPanner.connect(this.wAListener);this.wASource.start(0,this.pausedTime,this.duration);this.startTime=
N.currentTime;var b=this;this.wASource.onended=function(){b.playing=!1;b.startTime=0;b.pausedTime=0;b.nextPlay&&b.nextPlay.replay()}}};O.prototype.replay=function(a){this.loaded?(this.stop(),this.play()):this.loadPlay=!0};O.prototype.stop=function(){this.pause();this.pausedTime=this.startTime=0};O.prototype.pause=function(){if(this.playing){this.pausedTime=this.getProgress();this.playing=!1;this.wASource.stop(0);var a=this;this.wASource.onended=function(){a.playing=!1}}};O.prototype.getProgress=function(){return this.playing?
N.currentTime-this.startTime+this.pausedTime:this.pausedTime};O.prototype.playPause=function(){this.playing?this.pause():this.play()};O.prototype.setNextPlay=function(a){this.nextPlay=a};O.prototype.setVolume=function(a){this.vol=a&&1>=a&&0<a?a:this.vol;this.wAGain.gain.value=this.vol};O.prototype.getVolume=function(){return this.vol};O.prototype.setSide=function(a){this.side=a;this.wAPanner&&this.wAPanner.setPosition(this.side,0,1-Math.abs(this.side))};O.prototype.getSide=function(){return this.side};
this.wAudio.newAudio=function(a,b){return new O(a,b)};var Y=function(a,b){var c,e,d=g.document.createElement("audio");if("string"==typeof a){var f=g.document.createElement("source");f.src=a;d.appendChild(f)}else for(c=0,e=a.length;c<e;c++)f=g.document.createElement("source"),f.src=a[c],d.appendChild(f);this.vol=b&&1>=b&&0<b?b:1;this.playing=0;this.audio=d;this.nextPlay=this.loaded=!1;this.audio.volume=this.vol;var h=this;this.audio.onloadeddata=function(){h.loaded=!0;w.load()};this.audio.onended=
function(){h.playing=!1;h.nextPlay&&h.nextPlay.play()};this.audio.load();w.add()};Y.prototype.play=function(a){this.playing||(a&&(this.vol=a&&1>=a&&0<a?a:this.vol,this.audio.volume=this.vol),this.playing=!0,this.audio.play())};Y.prototype.replay=function(a){a&&this.setVolume(a);this.playing=!0;this.audio.currentTime=0;this.audio.play()};Y.prototype.stop=function(){this.playing&&(this.playing=!1,this.audio.pause(),this.audio.currentTime=0)};Y.prototype.pause=function(){this.playing&&(this.playing=
!1,this.audio.pause())};Y.prototype.playPause=function(){this.playing?this.pause():this.play()};Y.prototype.setNextPlay=function(a){this.nextPlay=a};Y.prototype.setVolume=function(a){this.vol=a&&1>=a&&0<a?a:this.vol;this.audio.volume=this.vol};Y.prototype.getVolume=function(){return this.vol};this.audio.newAudio=function(a,b){return new Y(a,b)};this.dialogs.openLine=function(a,b){V.game.stop();var c=g.document.createElement("input");c.type="text";c.style.position="fixed";c.style.border="none";c.style.zIndex=
n.style.zIndex+1;c.style.outline="none";c.style.backgroundColor=a.fillColor||"white";c.style.color=a.color||"black";c.style.top=(a.y?a.y>>0:0)+"px";c.style.left=(a.x?a.x>>0:0)+"px";c.style.width=(a.w?a.w>>0:0)+"px";c.style.fontSize=(a.size?a.size>>0:10)+"px";c.onclick=function(a){a.stopPropagation()};c.onkeydown=function(a){a.stopPropagation();if(27==a.keyCode||13==a.keyCode)a=c.value.trim(),"function"==typeof b&&b(""!=a?a:!1),g.document.body.removeChild(c),V.game.resume()};l.attach(c);c.focus()};
this.dialogs.openArea=function(a,b){V.game.stop();var c=g.document.createElement("textarea");c.style.position="fixed";c.style.border="none";c.style.zIndex=n.style.zIndex+1;c.style.overflowY="scroll";c.style.outline="none";c.style.backgroundColor=a.fillColor||"white";c.style.color=a.color||"black";c.style.top=(a.y?a.y>>0:0)+"px";c.style.left=(a.x?a.x>>0:0)+"px";c.style.width=(a.w?a.w>>0:0)+"px";c.style.height=(a.h?a.h>>0:0)+"px";c.style.fontSize=(a.size?a.size>>0:10)+"px";c.style.maxWidth=(a.w?a.w>>
0:0)+"px";c.style.maxHeight=(a.h?a.h>>0:0)+"px";c.onclick=function(a){a.stopPropagation()};c.onkeydown=function(a){a.stopPropagation();27==a.keyCode&&(a=c.value.trim(),"function"==typeof b&&b(""!=a?a:!1),g.document.body.removeChild(c),V.game.resume())};l.attach(c);c.focus()};this.dialogs.openTouchLine=function(a,b,c){V.game.stop();V.touchControl.exitTouchControl();var d=g.document.createElement("input");d.type="text";d.style.position="fixed";d.style.border="none";d.style.zIndex=n.style.zIndex+1;d.style.outline=
"none";d.style.backgroundColor=a.fillColor||"white";d.style.color=a.color||"black";d.style.top=(a.y?a.y>>0:0)+"px";d.style.left=(a.x?a.x>>0:0)+"px";d.style.width=(a.w?a.w>>0:0)+"px";d.style.fontSize=(a.size?a.size>>0:10)+"px";var f=g.document.createElement("div");f.style.padding=(b.padding||10)+"px";f.align="center";f.style.position="fixed";f.style.border="none";f.style.zIndex=n.style.zIndex+1;f.style.backgroundColor=b.fillColor||"white";f.style.color=b.color||"black";f.innerHTML=b.text||"OK";f.style.top=
(b.y?b.y>>0:0)+"px";f.style.left=(b.x?b.x>>0:0)+"px";b.w&&(f.style.width=(b.w>>0)+"px");b.h&&(f.style.height=(b.h>>0)+"px");f.style.fontSize=(b.size?b.size>>0:10)+"px";f.addEventListener("touchstart",function(a){a.preventDefault();a.stopPropagation();V.touchControl.initTouchControl();a=d.value.trim();"function"==typeof c&&c(""!=a?a:!1);g.document.body.removeChild(d);g.document.body.removeChild(f);V.game.resume()},!0);l.attach(d);l.attach(f);d.focus()};var w={count:0,loaded:0,errored:0,add:function(){this.count+=
1},load:function(){this.loaded+=1},error:function(){this.errored+=1}};this.resources.isLoaded=function(){return w.count==w.loaded};this.resources.getProgress=function(){return Math.ceil(w.loaded/w.count*100)};var Rb=0,Sb=0,ob=0;this.system.initFPSCheck=function(){l.addEvent("postLoop","fpsCheckUpdate",function(){ob+=1;1E3<=E-Sb&&(Rb=ob,ob=0,Sb=E)})};this.system.getFPS=function(){return Rb};this.OOP.newRever=function(a,b,c){var d=function(a,b,c){this.min=a;this.max=b;this.step=c;this.value=a;this.to=
c};d.prototype={update:function(){var a=this.value;this.value<=this.min?this.to=this.step:this.value>=this.max&&(this.to=-this.step);this.value+=this.to;return a},getValue:function(){return this.value},setValue:function(a){this.value=parseFloat(a)},setStep:function(a){this.step=a},getStep:function(){return this.step}};return new d(a,b,c)};var Tb={};this.OOP.once=function(a,b){Tb[a]||(Tb[a]=!0,b())};this.OOP.newTimer=function(a,b){if(0>=a)return ha("error in system.newTimer: variable < 0, Timer is not created");
var c={time:0<a?a:1E3,func:b,startTime:!1,ending:!1,start:function(){this.ending||this.startTime||(this.startTime=E)},run:function(){!this.ending&&this.startTime&&E-this.startTime>=this.time&&(this.func(),this.ending=!0)},end:function(){this.ending||(this.ending=!0,this.func())},restart:function(a){this.startTime||this.start();if(this.ending){if(a&&0>=a)return ha("error in Timer.restart: variable < 0");a&&(this.time=a);this.ending=!1;this.startTime=E}},stop:function(){this.ending||(this.ending=!0)}};
l.addEvent("postLoop","timer"+W(-100,100)*W(-100,100)+E,function(){c.run()});return c};g.onload=function(){for(var a in v)k[a]=v[a];k.save();for(a in l.events.onload)if("function"==typeof l.events.onload[a])l.events.onload[a]();l.loaded=!0;return!1};g.onblur=function(){if(ba)return l.runEvent("gameBlur"),!1};g.onfocus=function(){if(!ba)return g.document.activeElement.blur(),g.focus(),l.runEvent("gameFocus"),!1};g.onresize=function(){l.runEvent("gameResize");k.textBaseline="top";return!1};g.onclick=
function(){g.document.activeElement.blur();g.focus()}};
